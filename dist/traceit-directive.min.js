angular.module("angular-traceit",[]).directive("traceit",["$timeout",function(a){return{restrict:"A",scope:{isVisible:"=",traceOptObj:"=traceOptObj",isOpen:"=traceToggle",doDelete:"=traceDelete",doRetrace:"=retraceTrigger",onhide:"&",onendtrace:"&",onclick:"&"},link:function(q,d,m){function g(r){return typeof r=="string"||r&&typeof r=="object"&&traceittoString.call(r)==stringClass||false}function l(r){return r&&typeof r=="object"&&typeof r.length=="number"&&Object.prototype.toString.call(r)==arrayClass||false}function h(s){if(!s){return true}if(l(s)||g(s)){return !s.length}for(var r in s){if(hasOwnProperty.call(s,r)){return false}}return true}var j=true;if(!h(m.useRelativePositioning)){if(m.useRelativePositioning=="false"){j=false}}var e=10;if(!h(m.traceCanvasPadding)){e=parseInt(m.traceCanvasPadding)}var p=3500;if(!h(m.redrawSpeed)){p=parseInt(m.redrawSpeed)}var i="pointer";if(!h(m.traceCursor)){i=m.traceCursor}var f=true;if(!h(m.isVisible)){if(m.isVisible=="false"){f=false}}var c={};if(!h(m.traceOptObj)){c=q.traceOptObj}if(!h(m.stroke)){c.stroke=m.stroke}if(!h(m.strokeWidth)){c["stroke-width"]=parseInt(m.strokeWidth)}if(!h(m.strokeOpacity)){c["stroke-opacity"]=parseFloat(m.strokeOpacity)}if(!h(m.fill)){c.fill=m.fill}if(!h(m.fillOpacity)){var b=m.fillOpacity;c["fill-opacity"]=parseFloat(b)}if(!h(m.strokeDasharray)){c["stroke-dasharray"]=m.strokeDasharray}if(!h(m.gapPoint)){c["gap-point"]=m.gapPoint}if(!h(m.zindex)){c.zindex=parseInt(m.zindex)}var o={traceOpt:c,useRelativePositioning:j,isVisible:f,traceCursor:i,redrawSpeed:p,traceCanvasPadding:e};o.onHide=function(){if(q.isOpen!=undefined){a(function(){q.isOpen=false})}if(m.onhide&&angular.isDefined(m.onhide)){return q.onhide()}};if(m.onendtrace&&angular.isDefined(m.onendtrace)){o.onEndTrace=function(){return q.onendtrace()}}if(m.onclick&&angular.isDefined(m.onclick)){var k=true;if(!h(m.donothideonclick)){k=false}o.onClick=function(r){q.onclick();if(k){r.hideTrace()}}}var n=function(){$(d).trace(o);var r=$(d).data("trace");q.$watch("isOpen",function(t,s){if(t!==s){if(r==undefined){if(t==true){o.isVisible="true";$(d).trace({traceOpt:o,useRelativePositioning:true})}}else{if(t==true){o.traceOpt.isVisible="true";r.reTrace(o.traceOpt)}else{$(d).trigger("hide.trace")}}}});q.$watch("doRetrace",function(t,s){if(t!==s){o.isVisible="true";if(r==undefined){o.isVisible="true";$(d).trace({traceOpt:o,useRelativePositioning:true})}else{o.traceOpt.isVisible="true";r.reTrace(o.traceOpt)}if(q.isOpen!=undefined){q.isOpen=true}}},true);q.$watch("doDelete",function(t,s){if(t!==s){if(r==undefined){return}else{$(d).trigger("delete.trace")}}});q.$on("reTrace",function(t,u){var s=$(d).data("trace");s.reTrace(o)})};a(n,0)}}}]);